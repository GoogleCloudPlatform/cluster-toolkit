blueprint_name: hpc-cluster-small

vars:
  billing_account: ## Set GCP Billing Account Here ##
  org_id: ## Set GCP Organization ID Here ##
  folder_id: ## Set GCP Folder ID Here ##
  project_id: ## Set GCP Project ID Here ##
  deployment_name: ## Set Deployment Name Here ##
  region: ## Set Region Here ##
  zone: ## Set Zone Here ##
  slurm_cluster_name: hpcsmall
  activate_apis:
    - compute.googleapis.com
    - file.googleapis.com

deployment_groups:
  - group: primary
    modules:
      # Source is an embedded resource, denoted by "resources/*" without ./, ../, /
      # as a prefix. To refer to a local resource, prefix with ./, ../ or /
      # Example - ./resources/network/vpc
      - source: community/modules/project/new-project
        kind: terraform
        id: project1

      - source: modules/network/vpc
        kind: terraform
        id: network1
        use: [project1]

      - source: ./modules/billing
        kind: terraform
        id: billing
        settings:
          display_name: example-alert"
          amount: 1000
          currency_code: USD
          threshold_rules: [10]

      - source: modules/file-system/filestore
        kind: terraform
        id: homefs
        use:
          - project1
          - network1
        settings:
          local_mount: /home

      - source: community/modules/compute/schedmd-slurm-gcp-v5-partition
        kind: terraform
        id: debug_partition
        use:
          - project1
          - network1
          - homefs
        settings:
          partition_name: debug
          node_count_dynamic_max: 2
          enable_placement: false
          machine_type: n2-standard-1
          is_default: true
          enable_shielded_vm: true

      - source: community/modules/compute/schedmd-slurm-gcp-v5-partition
        kind: terraform
        id: compute_partition
        use:
          - project1
          - network1
          - homefs
        settings:
          partition_name: compute
          node_count_dynamic_max: 5
          machine_type: c2-standard-4
          enable_shielded_vm: true

      - source: community/modules/scheduler/schedmd-slurm-gcp-v5-controller
        kind: terraform
        id: slurm_controller
        use:
          - project1
          - network1
          - debug_partition
          - compute_partition
          - homefs
        settings:
          enable_shielded_vm: true

      - source: community/modules/scheduler/schedmd-slurm-gcp-v5-login
        kind: terraform
        id: slurm_login
        use:
          - project1
          - network1
          - slurm_controller
        settings:
          machine_type: n2-standard-2
          enable_shielded_vm: true
